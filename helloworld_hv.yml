- name: Hello-world test in hypervisor
  hosts: testers
  tasks:
    - name: Set global vars
      ansible.builtin.set_fact:
        date: "{{ lookup('pipe', 'date +%-d-%-m-%Y_%H-%M-%S') }}"
        toolkit_dir: "{{ playbook_dir }}/deployment_toolkit"
        hypervisor: "{{ hostvars[groups.machines[0]] }}"
        
    - name: Create results directory
      ansible.builtin.file:
        path: "{{ playbook_dir }}/_results/{{ date }}"
        state: directory
      register: results_path

# - name: Install hypervisor requirements
  # ansible.builtin.import_playbook: "requirements/hypervisor.yml"

- name: Install tester requirements
  ansible.builtin.import_playbook: "requirements/tester.yml"

- name: Deploy BenchFaster 
  ansible.builtin.import_playbook: "deployment_toolkit/main_hv.yml"
  vars:
    hypervisor: "{{ hostvars.hypervisor }}"

- name: Run helloworld benchmark  
  ansible.builtin.import_playbook: "performance_tests/helloworld/helloworld_test.yml"
